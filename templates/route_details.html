<!-- templates/route_details.html - COMPLETE VERSION -->
{% extends "base.html" %}

{% block title %}Route Details - Route Analytics Pro{% endblock %}

{% block content %}
<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row g-2 align-items-center">
            <div class="col">
                <h2 class="page-title">Route Analysis Details</h2>
                <div class="text-muted mt-1">Comprehensive analysis with interactive maps and real-time data</div>
            </div>
            <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                    <a href="{{ url_for('generate_pdf_report') }}" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-15"/>
                            <polyline points="7,10 12,15 17,10"/>
                        </svg>
                        Download Full PDF Report
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row row-deck row-cards">
    <!-- Route Overview -->
    <div class="col-12">
        <div class="card route-card">
            <div class="card-header">
                <h3 class="card-title">Route Overview</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <td><strong>From:</strong></td>
                                <td>{{ route_data.from_address }}</td>
                            </tr>
                            <tr>
                                <td><strong>To:</strong></td>
                                <td>{{ route_data.to_address }}</td>
                            </tr>
                            <tr>
                                <td><strong>Distance:</strong></td>
                                <td>{{ route_data.distance }}</td>
                            </tr>
                            <tr>
                                <td><strong>Duration:</strong></td>
                                <td>{{ route_data.duration }}</td>
                            </tr>
                            <tr>
                                <td><strong>Route Points:</strong></td>
                                <td>{{ route_data.total_points }} coordinates</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <div class="row g-2">
                            <div class="col-6">
                                <div class="card bg-danger-lt">
                                    <div class="card-body p-2 text-center">
                                        <div class="h2 m-0">{{ route_data.sharp_turns|length }}</div>
                                        <div class="text-muted">Sharp Turns</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card bg-warning-lt">
                                    <div class="card-body p-2 text-center">
                                        <div class="h2 m-0">{{ route_data.network_coverage.dead_zones|length }}</div>
                                        <div class="text-muted">Dead Zones</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card bg-info-lt">
                                    <div class="card-body p-2 text-center">
                                        <div class="h2 m-0">{{ route_data.weather|length }}</div>
                                        <div class="text-muted">Weather Points</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card bg-success-lt">
                                    <div class="card-body p-2 text-center">
                                        {% set poi_count = (route_data.petrol_bunks|length) + (route_data.hospitals|length) + (route_data.schools|length) %}
                                        <div class="h2 m-0">{{ poi_count }}</div>
                                        <div class="text-muted">POIs</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Route Map -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    Complete Route Map with All Hazards & POIs
                </h3>
            </div>
            <div class="card-body p-0">
                <div id="complete-route-map" class="map-container"></div>
                <div class="p-3">
                    <div class="network-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #28a745;"></div>
                            <span>Start Point</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #dc3545;"></div>
                            <span>End Point / Critical Turns (>70°)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #fd7e14;"></div>
                            <span>Sharp Turns (45-70°)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #0891b2;"></div>
                            <span>Hospitals</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #7c3aed;"></div>
                            <span>Fuel Stations</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #059669;"></div>
                            <span>Schools</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #6b7280;"></div>
                            <span>Network Dead Zones</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Coverage Analysis -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M5 12.55a11 11 0 0 1 14.08 0"/>
                        <path d="M1.42 9a16 16 0 0 1 21.16 0"/>
                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/>
                        <path d="M12 20h.01"/>
                    </svg>
                    Network Coverage Analysis
                </h3>
            </div>
            <div class="card-body">
                {% set coverage_stats = route_data.network_coverage.coverage_stats %}
                
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card bg-primary-lt">
                            <div class="card-body text-center p-3">
                                <div class="h2 m-0">{{ coverage_stats.api_success_rate|round(1) }}%</div>
                                <div class="text-muted">API Success Rate</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success-lt">
                            <div class="card-body text-center p-3">
                                <div class="h2 m-0">{{ coverage_stats.overall_coverage_score|round(1) }}</div>
                                <div class="text-muted">Coverage Score</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-danger-lt">
                            <div class="card-body text-center p-3">
                                <div class="h2 m-0">{{ route_data.network_coverage.dead_zones|length }}</div>
                                <div class="text-muted">Dead Zones</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning-lt">
                            <div class="card-body text-center p-3">
                                <div class="h2 m-0">{{ route_data.network_coverage.poor_zones|length }}</div>
                                <div class="text-muted">Poor Coverage</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Network Coverage Map -->
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Network Coverage Map</h4>
                    </div>
                    <div class="card-body p-0">
                        <div id="network-coverage-map" class="map-container"></div>
                        <div class="p-3">
                            <div class="network-legend">
                                <div class="legend-item">
                                    <div class="legend-color coverage-excellent"></div>
                                    <span>Excellent Coverage</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color coverage-good"></div>
                                    <span>Good Coverage</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color coverage-fair"></div>
                                    <span>Fair Coverage</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color coverage-poor"></div>
                                    <span>Poor Coverage</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color coverage-dead"></div>
                                    <span>Dead Zones</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coverage Quality Distribution -->
                {% if coverage_stats.quality_distribution %}
                <div class="mt-4">
                    <h4>Signal Quality Distribution</h4>
                    <div class="row">
                        {% for quality, count in coverage_stats.quality_distribution.items() %}
                        {% if count > 0 %}
                        <div class="col-md-2 mb-2">
                            <div class="card coverage-{{ quality }}">
                                <div class="card-body text-center p-2">
                                    <div class="h4 m-0">{{ count }}</div>
                                    <div class="small">{{ quality.title() }}</div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sharp Turns Analysis -->
    <div class="col-md-6">
        <div class="card danger-card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                    </svg>
                    Critical Sharp Turns ({{ route_data.sharp_turns|length }})
                </h3>
            </div>
            <div class="card-body">
                {% if route_data.sharp_turns %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Angle</th>
                                <th>Classification</th>
                                <th>Coordinates</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for turn in route_data.sharp_turns[:10] %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td><span class="badge bg-danger">{{ turn.angle }}°</span></td>
                                <td>{{ turn.classification }}</td>
                                <td><small>{{ "%.4f, %.4f"|format(turn.lat, turn.lng) }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if route_data.sharp_turns|length > 10 %}
                <div class="text-muted text-center">
                    <small>... and {{ route_data.sharp_turns|length - 10 }} more turns in PDF report</small>
                </div>
                {% endif %}
                {% else %}
                <div class="empty">
                    <div class="empty-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20,6 9,17 4,12"/>
                        </svg>
                    </div>
                    <p class="empty-title">No Critical Sharp Turns</p>
                    <p class="empty-subtitle text-muted">This route appears to have safe turning angles.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Weather Conditions -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/>
                    </svg>
                    Weather Conditions ({{ route_data.weather|length }})
                </h3>
            </div>
            <div class="card-body">
                {% if route_data.weather %}
                <div class="row g-2">
                    {% for weather in route_data.weather %}
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body p-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>{{ weather.location }}</strong>
                                        <div class="text-muted small">{{ weather.description.title() }}</div>
                                    </div>
                                    <div class="text-end">
                                        <div class="h4 m-0 {% if weather.temp > 35 %}text-danger{% elif weather.temp < 10 %}text-info{% endif %}">
                                            {{ weather.temp }}°C
                                        </div>
                                        <div class="small text-muted">{{ weather.humidity }}% humidity</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty">
                    <div class="empty-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/>
                        </svg>
                    </div>
                    <p class="empty-title">No Weather Data</p>
                    <p class="empty-subtitle text-muted">Weather information not available for this route.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Points of Interest -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    Points of Interest Along Route
                </h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Hospitals -->
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title text-info">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                                        <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"/>
                                        <path d="M12 5L8 21l4-7 4 7-4-16"/>
                                    </svg>
                                    Hospitals ({{ route_data.hospitals|length }})
                                </h4>
                            </div>
                            <div class="card-body p-2">
                                {% if route_data.hospitals %}
                                {% for name, location in route_data.hospitals.items() %}
                                {% if loop.index <= 5 %}
                                <div class="mb-2">
                                    <div class="small fw-bold">{{ name[:30] }}{% if name|length > 30 %}...{% endif %}</div>
                                    <div class="text-muted small">{{ location[:40] }}{% if location|length > 40 %}...{% endif %}</div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% if route_data.hospitals|length > 5 %}
                                <div class="text-muted small">... and {{ route_data.hospitals|length - 5 }} more</div>
                                {% endif %}
                                {% else %}
                                <div class="text-muted small">None found</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Fuel Stations -->
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title text-warning">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                                        <line x1="3" y1="22" x2="15" y2="22"/>
                                        <line x1="4" y1="9" x2="14" y2="9"/>
                                        <path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/>
                                        <path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"/>
                                    </svg>
                                    Fuel Stations ({{ route_data.petrol_bunks|length }})
                                </h4>
                            </div>
                            <div class="card-body p-2">
                                {% if route_data.petrol_bunks %}
                                {% for name, location in route_data.petrol_bunks.items() %}
                                {% if loop.index <= 5 %}
                                <div class="mb-2">
                                    <div class="small fw-bold">{{ name[:30] }}{% if name|length > 30 %}...{% endif %}</div>
                                    <div class="text-muted small">{{ location[:40] }}{% if location|length > 40 %}...{% endif %}</div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% if route_data.petrol_bunks|length > 5 %}
                                <div class="text-muted small">... and {{ route_data.petrol_bunks|length - 5 }} more</div>
                                {% endif %}
                                {% else %}
                                <div class="text-muted small">None found</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Schools -->
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title text-success">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                                        <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                        <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                                    </svg>
                                    Schools ({{ route_data.schools|length }})
                                </h4>
                            </div>
                            <div class="card-body p-2">
                                {% if route_data.schools %}
                                {% for name, location in route_data.schools.items() %}
                                {% if loop.index <= 5 %}
                                <div class="mb-2">
                                    <div class="small fw-bold">{{ name[:30] }}{% if name|length > 30 %}...{% endif %}</div>
                                    <div class="text-muted small">{{ location[:40] }}{% if location|length > 40 %}...{% endif %}</div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% if route_data.schools|length > 5 %}
                                <div class="text-muted small">... and {{ route_data.schools|length - 5 }} more</div>
                                {% endif %}
                                {% else %}
                                <div class="text-muted small">None found</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Food Stops -->
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title text-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"/>
                                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/>
                                        <line x1="6" y1="1" x2="6" y2="4"/>
                                        <line x1="10" y1="1" x2="10" y2="4"/>
                                        <line x1="14" y1="1" x2="14" y2="4"/>
                                    </svg>
                                    Restaurants ({{ route_data.food_stops|length }})
                                </h4>
                            </div>
                            <div class="card-body p-2">
                                {% if route_data.food_stops %}
                                {% for name, location in route_data.food_stops.items() %}
                                {% if loop.index <= 5 %}
                                <div class="mb-2">
                                    <div class="small fw-bold">{{ name[:30] }}{% if name|length > 30 %}...{% endif %}</div>
                                    <div class="text-muted small">{{ location[:40] }}{% if location|length > 40 %}...{% endif %}</div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% if route_data.food_stops|length > 5 %}
                                <div class="text-muted small">... and {{ route_data.food_stops|length - 5 }} more</div>
                                {% endif %}
                                {% else %}
                                <div class="text-muted small">None found</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Coverage Dead Zones Alert -->
    {% if route_data.network_coverage.dead_zones %}
    <div class="col-12">
        <div class="alert alert-danger" role="alert">
            <div class="d-flex">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <div>
                    <h4 class="alert-title">Critical: Network Dead Zones Detected!</h4>
                    <div class="text-muted">
                        <strong>{{ route_data.network_coverage.dead_zones|length }} area(s)</strong> with no cellular coverage detected along your route.
                        This means emergency calls may not be possible in these locations.
                    </div>
                    <div class="mt-2">
                        <strong>Safety Recommendations:</strong>
                        <ul class="mb-0">
                            <li>Inform contacts about communication blackouts</li>
                            <li>Download offline maps before travel</li>
                            <li>Carry alternative communication devices</li>
                            <li>Plan emergency contact procedures</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Poor Coverage Zones Warning -->
    {% if route_data.network_coverage.poor_zones %}
    <div class="col-12">
        <div class="alert alert-warning" role="alert">
            <div class="d-flex">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                    </svg>
                </div>
                <div>
                    <h4 class="alert-title">Warning: Poor Coverage Areas Detected</h4>
                    <div class="text-muted">
                        <strong>{{ route_data.network_coverage.poor_zones|length }} area(s)</strong> with poor cellular coverage detected.
                        Communication may be unreliable in these zones.
                    </div>
                    <div class="mt-2">
                        <strong>Additional Precautions:</strong>
                        <ul class="mb-0">
                            <li>Download important documents offline</li>
                            <li>Keep devices fully charged</li>
                            <li>Use WiFi calling when available</li>
                            <li>Allow extra time for communications</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Network Coverage Recommendations -->
    {% if route_data.network_coverage.recommendations %}
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M9 11H1l6-6v4a9.02 9.02 0 0 1 7.834 4.66"/>
                        <path d="M15 13h8l-6 6v-4A9.02 9.02 0 0 1 8.166 10.34"/>
                    </svg>
                    Network Coverage Recommendations
                </h3>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for recommendation in route_data.network_coverage.recommendations %}
                    <div class="col-md-6 mb-3">
                        <div class="card {% if recommendation.type == 'critical' %}border-danger{% elif recommendation.type == 'warning' %}border-warning{% elif recommendation.type == 'success' %}border-success{% else %}border-info{% endif %}">
                            <div class="card-header">
                                <h5 class="card-title {% if recommendation.type == 'critical' %}text-danger{% elif recommendation.type == 'warning' %}text-warning{% elif recommendation.type == 'success' %}text-success{% else %}text-info{% endif %}">
                                    {{ recommendation.title }}
                                </h5>
                            </div>
                            <div class="card-body p-3">
                                <p class="text-muted">{{ recommendation.description }}</p>
                                <ul class="mb-0">
                                    {% for action in recommendation.actions %}
                                    <li>{{ action }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Final Safety Summary -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    Safety Summary & Recommendations
                </h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h4>Pre-Journey Checklist</h4>
                        <ul>
                            <li><strong>Download offline maps</strong> for the entire route</li>
                            <li><strong>Inform contacts</strong> of your travel plans and timeline</li>
                            <li><strong>Charge all devices</strong> and carry power banks</li>
                            <li><strong>Review sharp turns</strong> - {{ route_data.sharp_turns|length }} identified</li>
                            <li><strong>Check weather conditions</strong> at departure</li>
                            <li><strong>Plan fuel stops</strong> - {{ route_data.petrol_bunks|length }} stations found</li>
                            <li><strong>Note hospital locations</strong> - {{ route_data.hospitals|length }} facilities identified</li>
                        </ul>

                        <h4 class="mt-4">During Travel</h4>
                        <ul>
                            <li><strong>Reduce speed</strong> at marked sharp turns</li>
                            <li><strong>Use horns</strong> on blind curves and turns >70°</li>
                            <li><strong>Maintain safe following distance</strong></li>
                            <li><strong>Observe school zone speeds</strong> - {{ route_data.schools|length }} schools identified</li>
                            <li><strong>Monitor signal strength</strong> and send updates when possible</li>
                            <li><strong>Stay alert</strong> in network dead zones</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h5>Emergency Contacts</h5>
                                <ul class="list-unstyled">
                                    <li><strong>Police:</strong> 100</li>
                                    <li><strong>Medical:</strong> 108</li>
                                    <li><strong>Fire:</strong> 101</li>
                                    <li><strong>Emergency:</strong> 112</li>
                                </ul>
                                
                                <h5 class="mt-3">Route Statistics</h5>
                                <ul class="list-unstyled">
                                    <li><strong>Distance:</strong> {{ route_data.distance }}</li>
                                    <li><strong>Duration:</strong> {{ route_data.duration }}</li>
                                    <li><strong>Sharp Turns:</strong> {{ route_data.sharp_turns|length }}</li>
                                    <li><strong>Dead Zones:</strong> {{ route_data.network_coverage.dead_zones|length }}</li>
                                    <li><strong>POIs:</strong> {{ poi_count }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize Google Maps
function initMaps() {
    const routePoints = {{ route_data.route_points|tojson }};
    const sharpTurns = {{ route_data.sharp_turns|tojson }};
    const networkCoverage = {{ route_data.network_coverage.coverage_analysis|tojson }};
    const deadZones = {{ route_data.network_coverage.dead_zones|tojson }};
    const poorZones = {{ route_data.network_coverage.poor_zones|tojson }};
    
    // Initialize Complete Route Map
    initCompleteRouteMap(routePoints, sharpTurns);
    
    // Initialize Network Coverage Map
    initNetworkCoverageMap(routePoints, networkCoverage, deadZones, poorZones);
}

function initCompleteRouteMap(routePoints, sharpTurns) {
    if (!routePoints || routePoints.length === 0) return;
    
    const map = new google.maps.Map(document.getElementById('complete-route-map'), {
        zoom: 10,
        center: { lat: routePoints[0][0], lng: routePoints[0][1] },
        mapTypeId: 'roadmap'
    });
    
    // Create route polyline
    const routePath = new google.maps.Polyline({
        path: routePoints.map(point => ({ lat: point[0], lng: point[1] })),
        geodesic: true,
        strokeColor: '#1f2937',
        strokeOpacity: 0.8,
        strokeWeight: 4
    });
    routePath.setMap(map);
    
    // Add start marker
    new google.maps.Marker({
        position: { lat: routePoints[0][0], lng: routePoints[0][1] },
        map: map,
        title: 'Start Point',
        icon: {
            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="#28a745">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3" fill="white"/>
                </svg>
            `),
            scaledSize: new google.maps.Size(32, 32)
        }
    });
    
    // Add end marker
    new google.maps.Marker({
        position: { lat: routePoints[routePoints.length-1][0], lng: routePoints[routePoints.length-1][1] },
        map: map,
        title: 'End Point',
        icon: {
            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="#dc3545">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3" fill="white"/>
                </svg>
            `),
            scaledSize: new google.maps.Size(32, 32)
        }
    });
    
    // Add sharp turn markers
    sharpTurns.forEach((turn, index) => {
        const color = turn.angle > 70 ? '#dc3545' : '#fd7e14';
        
        new google.maps.Marker({
            position: { lat: turn.lat, lng: turn.lng },
            map: map,
            title: `Sharp Turn ${index + 1}: ${turn.angle}° - ${turn.classification}`,
            icon: {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="${color}">
                        <path d="M12 2L2 22h20L12 2z"/>
                        <text x="12" y="16" text-anchor="middle" fill="white" font-size="8" font-weight="bold">${index + 1}</text>
                    </svg>
                `),
                scaledSize: new google.maps.Size(24, 24)
            }
        });
    });
    
    // Add POI markers (simplified for demo)
    const hospitals = {{ route_data.hospitals|tojson }};
    const petrolBunks = {{ route_data.petrol_bunks|tojson }};
    const schools = {{ route_data.schools|tojson }};
    
    // Add sample POI markers distributed along route
    let poiIndex = 0;
    Object.keys(hospitals).slice(0, 3).forEach(name => {
        if (routePoints.length > poiIndex * 10) {
            const point = routePoints[poiIndex * 10];
            new google.maps.Marker({
                position: { lat: point[0] + 0.001, lng: point[1] + 0.001 },
                map: map,
                title: `Hospital: ${name}`,
                icon: {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#0891b2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <path d="M12 6v6m-3-3h6" stroke="white" stroke-width="2"/>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(20, 20)
                }
            });
            poiIndex++;
        }
    });
    
    // Fit map to show all markers
    const bounds = new google.maps.LatLngBounds();
    routePoints.forEach(point => bounds.extend({ lat: point[0], lng: point[1] }));
    map.fitBounds(bounds);
}

function initNetworkCoverageMap(routePoints, coverageAnalysis, deadZones, poorZones) {
    if (!routePoints || routePoints.length === 0) return;
    
    const map = new google.maps.Map(document.getElementById('network-coverage-map'), {
        zoom: 10,
        center: { lat: routePoints[0][0], lng: routePoints[0][1] },
        mapTypeId: 'roadmap'
    });
    
    // Create route polyline
    const routePath = new google.maps.Polyline({
        path: routePoints.map(point => ({ lat: point[0], lng: point[1] })),
        geodesic: true,
        strokeColor: '#6b7280',
        strokeOpacity: 0.6,
        strokeWeight: 3
    });
    routePath.setMap(map);
    
    // Add coverage analysis points
    coverageAnalysis.forEach((point, index) => {
        const quality = point.coverage_quality;
        let color = '#6b7280'; // Default gray
        
        switch(quality) {
            case 'excellent': color = '#28a745'; break;
            case 'good': color = '#20c997'; break;
            case 'fair': color = '#ffc107'; break;
            case 'poor': color = '#fd7e14'; break;
            case 'dead': color = '#dc3545'; break;
            case 'api_failed': color = '#6b7280'; break;
        }
        
        new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,
            fillOpacity: 0.35,
            map: map,
            center: { lat: point.coordinates.lat, lng: point.coordinates.lng },
            radius: 500 // 500 meter radius
        });
        
        // Add marker for dead zones and poor coverage
        if (quality === 'dead' || quality === 'poor') {
            new google.maps.Marker({
                position: { lat: point.coordinates.lat, lng: point.coordinates.lng },
                map: map,
                title: `${quality.toUpperCase()} Coverage Area`,
                icon: {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${color}">
                            <circle cx="12" cy="12" r="10"/>
                            <text x="12" y="16" text-anchor="middle" fill="white" font-size="10" font-weight="bold">!</text>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(20, 20)
                }
            });
        }
    });
    
    // Fit map to show all points
    const bounds = new google.maps.LatLngBounds();
    routePoints.forEach(point => bounds.extend({ lat: point[0], lng: point[1] }));
    map.fitBounds(bounds);
}

// Load Google Maps API
function loadGoogleMaps() {
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&callback=initMaps`;
    script.async = true;
    script.defer = true;
    document.head.appendChild(script);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', loadGoogleMaps);
</script>
{% endblock %}